# FÃ¶rsÃ¤kringskassan AI åŠ©æ‰‹ - æ–¹æ¡ˆ 1: OpenAI Agent SDK

åŸºäº OpenAI Responses API å’Œ Agent SDK çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œç”¨äºå›ç­”å…³äºç‘å…¸ fÃ¶rÃ¤ldrarpenningï¼ˆçˆ¶æ¯æ´¥è´´ï¼‰å’Œ barnï¼ˆå„¿ç«¥ï¼‰çš„é—®é¢˜ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ“„ **PDF æ–‡ä»¶ä¸Šä¼ **: ä¸Šä¼  PDF åˆ° OpenAI Vector Store è¿›è¡Œæ™ºèƒ½æœç´¢
- ğŸ” **æ–‡ä»¶æœç´¢**: ä½¿ç”¨ OpenAI çš„ file_search å·¥å…·åœ¨ä¸Šä¼ çš„æ–‡æ¡£ä¸­æœç´¢ä¿¡æ¯
- ğŸŒ **ç½‘ç»œæœç´¢**: ä½¿ç”¨ OpenAI å†…ç½®çš„ web_search_preview å·¥å…·è¿›è¡Œå®æ—¶ç½‘ç»œæœç´¢
- ğŸ’¾ **å¯¹è¯è®°å¿†**: è‡ªåŠ¨ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œæä¾›æ›´å‡†ç¡®çš„å›ç­”
- ğŸ’° **æˆæœ¬ä¼˜åŒ–**: ä½¿ç”¨ gpt-4o-miniï¼ˆOpenAI æœ€ä¾¿å®œçš„æ¨¡å‹ï¼‰
- ğŸ“Š **ä½¿ç”¨ç»Ÿè®¡**: å®æ—¶æ˜¾ç¤º Token ä½¿ç”¨é‡å’Œé¢„ä¼°æˆæœ¬
- ğŸ¨ **ç°ä»£ UI**: ä½¿ç”¨ Tailwind CSS æ„å»ºçš„å“åº”å¼ç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå‚è€ƒ `.env.example`ï¼‰ï¼š

```env
# OpenAI API Keyï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=your_openai_api_key_here

# æœåŠ¡å™¨é…ç½®ï¼ˆå¯é€‰ï¼‰
PORT=3000
NODE_ENV=development
```

### 3. å¯åŠ¨æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š[http://localhost:3000](http://localhost:3000)

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æ­¥éª¤ 1ï¼šä¸Šä¼  PDF æ–‡ä»¶

1. ç‚¹å‡»"é€‰æ‹© PDF æ–‡ä»¶"æŒ‰é’®
2. é€‰æ‹©ä¸€ä¸ªå…³äº FÃ¶rsÃ¤kringskassan çš„ PDF æ–‡ä»¶ï¼ˆæœ€å¤§ 10MBï¼‰
3. ç‚¹å‡»"å¼€å§‹ä¸Šä¼ "
4. ç­‰å¾…æ–‡ä»¶ä¸Šä¼ åˆ° OpenAI Vector Store

### æ­¥éª¤ 2ï¼šæé—®

1. åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥æ‚¨çš„é—®é¢˜
2. ä¾‹å¦‚ï¼š"Hur mÃ¥nga dagar med fÃ¶rÃ¤ldrapenning kan man fÃ¥?"
3. ç‚¹å‡»"æäº¤é—®é¢˜å¹¶æœç´¢"æŒ‰é’®
4. ç³»ç»Ÿä¼šåŒæ—¶æ‰§è¡Œï¼š
   - æ–‡ä»¶æœç´¢ï¼šåœ¨ä¸Šä¼ çš„ PDF ä¸­æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯
   - ç½‘ç»œæœç´¢ï¼šåœ¨äº’è”ç½‘ä¸ŠæŸ¥æ‰¾æœ€æ–°ä¿¡æ¯

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹ç»“æœ

- æŸ¥çœ‹æ–‡ä»¶æœç´¢å’Œç½‘ç»œæœç´¢çš„ç»“æœ
- æŸ¥çœ‹ Token ä½¿ç”¨ç»Ÿè®¡å’Œé¢„ä¼°æˆæœ¬
- æŸ¥çœ‹å¯¹è¯å†å²

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
FK_Jinyan_Liu_Kurs3_202511/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ solution1/              # æ–¹æ¡ˆ1: OpenAIå®ç°
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ fileService.js      # æ–‡ä»¶ä¸Šä¼ æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ responseService.js  # æŸ¥è¯¢å“åº”æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ memoryService.js    # è®°å¿†ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ api.js             # APIè·¯ç”±
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ errorHandler.js    # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ constants.js       # é…ç½®å¸¸é‡
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ validators.js      # è¾“å…¥éªŒè¯
â”‚   â”œâ”€â”€ public/                # å‰ç«¯æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ js/
â”‚   â”‚       â””â”€â”€ app.js
â”‚   â””â”€â”€ assets/                # é™æ€èµ„æº
â”œâ”€â”€ uploads/                   # ä¸´æ—¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ server.js                  # ExpressæœåŠ¡å™¨
â”œâ”€â”€ package.json
â””â”€â”€ .env                       # ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦åˆ›å»ºï¼‰
```

## ğŸ”Œ API ç«¯ç‚¹

### ä¸Šä¼  PDF

```http
POST /api/solution1/upload
Content-Type: multipart/form-data

Body:
- pdf: PDFæ–‡ä»¶

Response:
{
  "success": true,
  "vectorStoreId": "vs_...",
  "fileId": "file_...",
  "fileName": "document.pdf",
  "status": "completed"
}
```

### æŸ¥è¯¢

```http
POST /api/solution1/query
Content-Type: application/json

Body:
{
  "query": "Hur mÃ¥nga dagar med fÃ¶rÃ¤ldrapenning kan man fÃ¥?",
  "vectorStoreId": "vs_...",
  "threadId": "user-session-123"
}

Response:
{
  "success": true,
  "fileAnswer": "...",
  "webAnswer": "...",
  "model": "gpt-4o-mini",
  "usage": {
    "input_tokens": 150,
    "output_tokens": 200,
    "total_tokens": 350,
    "estimated_cost": 0.000142
  }
}
```

### è·å–å¯¹è¯å†å²

```http
GET /api/solution1/history/:threadId?limit=10

Response:
{
  "success": true,
  "threadId": "user-session-123",
  "summary": {
    "exists": true,
    "messageCount": 5,
    "totalUsage": { ... }
  },
  "history": [ ... ]
}
```

### æ¸…é™¤å¯¹è¯å†å²

```http
DELETE /api/solution1/history/:threadId

Response:
{
  "success": true,
  "message": "History cleared successfully"
}
```

## ğŸ’° æˆæœ¬ä¿¡æ¯

ä½¿ç”¨ **gpt-4o-mini** æ¨¡å‹ï¼ˆOpenAI æœ€ä¾¿å®œçš„é€‰é¡¹ï¼‰ï¼š

- è¾“å…¥: $0.15 / 1M tokens
- è¾“å‡º: $0.60 / 1M tokens

ç¤ºä¾‹æˆæœ¬ï¼š

- ä¸€ä¸ªå…¸å‹çš„æŸ¥è¯¢ï¼ˆ150 è¾“å…¥ + 200 è¾“å‡º tokensï¼‰â‰ˆ $0.00014
- 100 æ¬¡æŸ¥è¯¢ â‰ˆ $0.014

## ğŸ§ª æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [ ] ä¸Šä¼  PDF æ–‡ä»¶

  - [ ] æˆåŠŸä¸Šä¼ å°äº 10MB çš„ PDF
  - [ ] æ‹’ç»é PDF æ–‡ä»¶
  - [ ] æ‹’ç»è¶…è¿‡ 10MB çš„æ–‡ä»¶
  - [ ] æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
  - [ ] æ˜¾ç¤ºä¸Šä¼ æˆåŠŸæ¶ˆæ¯

- [ ] æ–‡ä»¶æœç´¢

  - [ ] åœ¨ä¸Šä¼ çš„ PDF ä¸­æ­£ç¡®æœç´¢ä¿¡æ¯
  - [ ] æ˜¾ç¤ºæœç´¢ç»“æœ
  - [ ] æ˜¾ç¤º Token ä½¿ç”¨ç»Ÿè®¡

- [ ] ç½‘ç»œæœç´¢

  - [ ] æ‰§è¡Œç½‘ç»œæœç´¢å¹¶è¿”å›ç»“æœ
  - [ ] åŒæ—¶æ˜¾ç¤ºæ–‡ä»¶å’Œç½‘ç»œæœç´¢ç»“æœ

- [ ] å¯¹è¯è®°å¿†

  - [ ] ä¿æŒå¯¹è¯ä¸Šä¸‹æ–‡
  - [ ] æ˜¾ç¤ºå¯¹è¯å†å²
  - [ ] æ¸…é™¤å¯¹è¯å†å²

- [ ] é”™è¯¯å¤„ç†
  - [ ] å¤„ç† API é”™è¯¯
  - [ ] å¤„ç†æ–‡ä»¶ä¸Šä¼ é”™è¯¯
  - [ ] æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API å¯†é’¥å®‰å…¨**:

   - æ°¸è¿œä¸è¦æäº¤ `.env` æ–‡ä»¶åˆ° Git
   - ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ² API å¯†é’¥
   - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯

2. **æˆæœ¬æ§åˆ¶**:

   - å®šæœŸæ£€æŸ¥ OpenAI ä½¿ç”¨é‡
   - è®¾ç½® API ä½¿ç”¨é™åˆ¶
   - è€ƒè™‘å®ç°æŸ¥è¯¢é™æµ

3. **æ–‡ä»¶å¤§å°é™åˆ¶**:

   - å½“å‰é™åˆ¶ä¸º 10MB
   - å¯ä»¥åœ¨ `constants.js` ä¸­è°ƒæ•´

4. **ç½‘ç»œæœç´¢**:
   - ä½¿ç”¨ OpenAI å†…ç½®çš„ `web_search_preview` å·¥å…·
   - æ— éœ€é¢å¤–çš„ API å¯†é’¥

## ğŸ”§ æ•…éšœæ’é™¤

### æœåŠ¡å™¨æ— æ³•å¯åŠ¨

```
Error: OPENAI_API_KEY environment variable is missing
```

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ `.env` æ–‡ä»¶å­˜åœ¨å¹¶åŒ…å«æœ‰æ•ˆçš„ OPENAI_API_KEY

### æ–‡ä»¶ä¸Šä¼ å¤±è´¥

```
Error: File processing timeout
```

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§ 10MBï¼‰
- ç¡®ä¿æ–‡ä»¶æ˜¯æœ‰æ•ˆçš„ PDF
- æ£€æŸ¥ OpenAI API é…é¢

### æŸ¥è¯¢å¤±è´¥

```
Error: Rate limit exceeded
```

**è§£å†³æ–¹æ¡ˆ**:

- ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•
- æ£€æŸ¥ OpenAI API é™é¢
- è€ƒè™‘å‡çº§ API è®¡åˆ’

## ğŸ“š æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js, Express
- **å‰ç«¯**: HTML, Tailwind CSS, Vanilla JavaScript
- **AI æœåŠ¡**: OpenAI Responses API, gpt-4o-mini
- **æ–‡ä»¶å¤„ç†**: Multer
- **ç¯å¢ƒé…ç½®**: dotenv

## ğŸš§ æœªæ¥æ”¹è¿›

- [ ] å®ç°æ–¹æ¡ˆ 2ï¼šLangchain Agentï¼ˆä½¿ç”¨å…è´¹çš„ Google Geminiï¼‰
- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯
- [ ] å®ç° Supabase å‘é‡å­˜å‚¨
- [ ] æ·»åŠ æ›´å¤šæ–‡ä»¶æ ¼å¼æ”¯æŒ
- [ ] å®ç°æŸ¥è¯¢é™æµ
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆVercel/Netlify/Railwayï¼‰

## ğŸ“ è®¸å¯è¯

ISC

## ğŸ‘¤ ä½œè€…

Jinyan Liu - Kurs 3 - 2025/11
